title: 从几个关键词来理解http缓存
author: TokenYangForever
tags:
  - http缓存
  - html
categories:
  - http
date: 2017-09-27 15:19:00
---
#### 前言
* 我对于http缓存的认知总是停留在略知一二的状态，毕竟实际工作中用的比较少-_-||
但作为一个严谨的程序员，这仍是必备的一个知识技能。想了想还是写篇博客来总结下相关的一些知识，从一些关键词来理解http的缓存
##### 强缓存与协商缓存
* 首先需要知道的是读取http缓存的方式是有两种的：**强缓存(本地缓存)**和**协商缓存(对比缓存)**，下面讲一下这两种工作方式的区别和特点。
* **强缓存**： 客户端发送请求时，首先访问浏览器的缓存数据库，若得知缓存存在且有效，则直接读取缓存内容返回给客户端，此时返回状态码为**200（from cache）**;而如果发现缓存失效了或不存在，则会去请求**服务器**得到相关内容信息，此时返回状态码为200，操作示意图如下
![强缓存.png](http://upload-images.jianshu.io/upload_images/6383319-5018186b2e518efc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* **协商缓存**： 客户端发送请求时，如果是第一次请求资源，则直接访问服务器，服务器将相关内容和缓存标示返回给客户端；如果是再次请求资源，**客户端将第一次访问时服务器返回的缓存标示发送给服务器，服务器来判断缓存是否可用，**如果缓存可用则告诉客户端可以继续使用缓存的内容，此时**返回码为304**，操作示意图如下
![协商缓存.png](http://upload-images.jianshu.io/upload_images/6383319-e872781570ae4356.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
* 综上可以直观的看出两种方式的区别，最明显的是**缓存命中时返回码不同**，还有对比缓存的方式：**每一次都会去访问服务器，无论缓存命中与否**。那么对于浏览器和服务器是如何区分强缓存还是对比缓存，以及如何判断缓存是否有效呢，这就需要那些放在**http报文header中**的相关字段了，接下来依次讲解他们。ps：两种缓存方式是可以同时存在的，同时存在时，强缓存的优先级更高。
#### expires
* 用于定义强缓存的header字段，这是http1.0时的规范，它的值为一个GMT格式时间字符串，如果发送请求的时间在expires之前，那么本地缓存始终有效，否则就会发送请求到服务器来获取资源。但是已经过时了，基本可以忽略。
#### cache-control
* http1.1版本出现的header信息，用来定义缓存信息。包括了好几个字段，其中最重要的就是**max-age**：用于表示缓存多少秒后失效。比如max-age = 31536000，表示缓存时间为365天，从第一次请求后的365天内再次请求都会去读取缓存。这个也是用来控制强制缓存的header字段。
##### 协商缓存相关的header字段
* 协商缓存的方式总是会去访问服务器来确定缓存是否可用的，所以需要通过某种标识来进行通信，主要包括下面两组header字段(他们都是要成对出现)，即第一次请求的响应头带上某个字段（**Last-Modified/Etag**），则后续请求头则会带上对应的请求字段（**If-Modified-Since/If-None-Match**），若响应头没有Last-Modified或者Etag字段，则请求头也不会有对应的字段。
##### Last-Modified  /  If-Modified-Since
* 这组值都是时间字符串。具体行为如下：第一次请求时服务器返回的response headers带上**Last-Modified字段表示资源最后一次修改的时间**，再次请求时浏览器的request headers带上**If-Modified-Since**这个值和第一次访问返回的Last-Modified值是一样的，然后给到服务器再进行判断缓存是否过期
##### Etag / If-None-Match
* 这组字段的值是服务器生成的唯一标示字符串，用法和上面的Last-Modified/If-Modified-Since类似，第一次访问时服务器会返回一个Etag，再次访问浏览器就会带上If-None-Match其值为第一次返回的Etag，给到服务器，服务器进行判断缓存是否可用。ps: Etag和Last-Modified同时使用时，服务器会**优先判断Etag**，好像是etag的精准级别更高。
#### 结语
* 大概就这么多了，都是以最基本的概念为主，参考了一些网上的资料，如果有机会的话再深入地研究下~~~
参考：[彻底弄懂HTTP缓存机制及原理](http://www.cnblogs.com/chenqf/p/6386163.html)